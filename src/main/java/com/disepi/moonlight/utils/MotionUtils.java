package com.disepi.moonlight.utils;

import cn.nukkit.Player;
import cn.nukkit.potion.Effect;
import com.disepi.moonlight.anticheat.player.PlayerData;

public class MotionUtils {
    public static final double PI = 3.1415927;
    public static final double DEG = PI / 180.0;
    public static final double DEG_RAD = 180.0 / PI;

    // The default downwards velocity
    public static final double GRAVITY = 0.07840000093;

    // The maximum speed you can reach while on ground
    public static final double GROUND_SPEED_DEFAULT = 0.38573077;

    // Default jump height value.
    public static final float JUMP_VALUE_DEFAULT = 0.42000008f;

    // Below are arrays of packet logged vanilla values.
    // This may not be the best solution but it saves performance from not needing to do the math and also because it is accurate and easier to create checks with
    public static final double[] GRAVITY_FALL_VALUES = {0.07537841796875, 0.227783203125, 0.45550537109375, 0.756988525390625, 1.130889892578125, 1.5758056640625, 2.090087890625, 2.6724853515625, 3.321685791015625, 4.036285400390625, 4.8149871826171875, 5.656585693359375, 6.5596923828125, 7.5230865478515625, 8.545684814453125, 9.626296997070312, 10.763595581054688, 11.956588745117188, 13.051895141601562, 14.20489501953125, 15.414199829101562, 16.678695678710938, 17.997390747070312, 19.369293212890625, 20.7930908203125, 22.267990112304688, 23.792892456054688, 25.36669921875, 26.988693237304688, 28.657699584960938, 30.372787475585938, 32.13319396972656, 33.93798828125, 35.78619384765625, 37.67698669433594, 39.609588623046875, 41.58319091796875, 43.59678649902344, 45.64979553222656, 47.74128723144531, 49.870697021484375, 52.03709411621094, 54.23968505859375, 56.477996826171875, 58.751190185546875, 61.05848693847656, 63.43218994140625, 65.83689880371094, 68.2427978515625, 70.6802978515625, 73.14869689941406, 75.64749145507812, 78.17599487304688, 80.73359680175781, 83.31979370117188, 85.93399047851562, 88.57559204101562, 91.24409484863281, 93.93899536132812, 96.65969848632812, 99.40568542480469, 102.17658996582031, 104.97189331054688, 107.7908935546875, 110.63339233398438, 113.49879455566406, 116.3865966796875, 119.29649353027344, 122.22799682617188, 125.18058776855469, 128.1538848876953, 131.14759063720703, 134.16119384765625, 137.19438934326172, 140.24668884277344, 143.31769561767578, 146.40719604492188, 149.51459503173828, 152.6397933959961, 155.78229522705078, 158.9416961669922, 162.11779022216797, 165.31019592285156, 168.51869201660156, 171.74269104003906, 174.98219299316406, 178.2366943359375, 181.50588989257812, 184.7896957397461, 188.08759307861328, 191.3993911743164, 194.72489166259766, 198.06369400024414, 201.41559219360352, 204.78029251098633};
    public static final double[] STRAFE_JUMP_VALUE = {0.6119349, 0.35959646, 0.3527128, 0.34644872, 0.34074834, 0.33556095, 0.33084047, 0.32654488, 0.32263598, 0.3190788, 0.31584153, 0.31289563, 0.31021532, 0.3077758, 0.30555612, 0.30353624, 0.30169803, 0.30002528, 0.2985027, 0.29711753, 0.29585674, 0.29470998, 0.29366618, 0.29271582, 0.2918518, 0.291065, 0.2903488, 0.28969744, 0.2891052, 0.28856543, 0.28807428, 0.28762797, 0.2872217, 0.28685167, 0.28651503, 0.2862089, 0.28592947, 0.2856758, 0.28544497, 0.2852352, 0.28504446, 0.28486994, 0.28471163, 0.28456762, 0.28443697, 0.28431776, 0.28420904, 0.28410986, 0.2840202, 0.28393817, 0.28386378, 0.2837961, 0.28373602, 0.2836769, 0.2836273, 0.28358153, 0.28353956, 0.28350142, 0.28346327, 0.28343275, 0.28340602, 0.28337553, 0.28335646, 0.28332976, 0.2833145, 0.2832916, 0.28328016, 0.2832611, 0.28324965, 0.2832382, 0.28322294, 0.2832153, 0.28320768, 0.28319624, 0.28319052, 0.2831829, 0.28317526, 0.28316954, 0.28316572, 0.28316, 0.2831562, 0.28315237, 0.28314856, 0.28314474, 0.28314093, 0.28313902, 0.2831371, 0.2831352, 0.2831314, 0.28312948, 0.28312948, 0.28312758, 0.28312567, 0.28312376, 0.28312376, 0.28312185, 0.28312185};

    // Returns the expected velocity based off the amount of ticks off ground
    public static double getExpectedFallValue(int fallTick) {
        if (fallTick < 0)
            return GRAVITY_FALL_VALUES[0];
        if (fallTick > GRAVITY_FALL_VALUES.length - 1)
            return GRAVITY_FALL_VALUES[GRAVITY_FALL_VALUES.length - 1];
        return GRAVITY_FALL_VALUES[fallTick];
    }

    // Gets the speed multiplier based off potion effect
    public static float getSpeedMultiplier(PlayerData player) {
        if (player.speedPotionLenientTicks < 0) return 1.0f; // If no speed potion is active then return default speed
        return 1.0f + ((player.lastSpeedAmplifier + 1) * 0.2f); // Return multiplier
    }

    // Returns the expected move velocity based off the amount of ticks off ground
    public static double getExpectedSpeedValue(int fallTick) {
        if (fallTick < 0)
            return STRAFE_JUMP_VALUE[0];
        if (fallTick > STRAFE_JUMP_VALUE.length - 1)
            return STRAFE_JUMP_VALUE[STRAFE_JUMP_VALUE.length - 1];
        return STRAFE_JUMP_VALUE[fallTick];
    }

}
