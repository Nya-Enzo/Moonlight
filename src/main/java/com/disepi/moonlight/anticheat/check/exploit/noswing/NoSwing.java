package com.disepi.moonlight.anticheat.check.exploit.noswing;

import cn.nukkit.Player;
import cn.nukkit.event.entity.EntityDamageByEntityEvent;
import cn.nukkit.network.protocol.PlayerActionPacket;
import com.disepi.moonlight.anticheat.check.Check;
import com.disepi.moonlight.anticheat.player.PlayerData;

import javax.swing.*;

public class NoSwing extends Check {
    // Constructor
    public NoSwing() {
        super("NoSwing", "Player did not swing as expected", 8);
    }

    boolean didPlayerSwing(PlayerData d)
    {
        long leniency = 200;
        long difference = System.currentTimeMillis() - d.lastSwingTime;
        return difference < leniency;
    }

    public void check(EntityDamageByEntityEvent e, PlayerData d, Player p) {
        if (!didPlayerSwing(d))
            fail(p, "expected swing did not occur");
    }

    public void check(PlayerActionPacket e, PlayerData d, Player p) {
        if (e.action == PlayerActionPacket.ACTION_START_BREAK && !didPlayerSwing(d))
            fail(p, "expected swing did not occur");
    }
}
